(function(a){function D(b,c,f,d){d={data:d||d===0||d===false?d:c?c.data:{},_wrap:c?c._wrap:null,tmpl:null,parent:c||null,nodes:[],calls:K,nest:g,wrap:i,html:j,update:h};b&&a.extend(d,b,{nodes:[],parent:c});if(f){d.tmpl=f;d._ctnt=d._ctnt||d.tmpl(a,d);d.key=++n;(q.length?s:l)[n]=d}return d}function A(b,c,f){var d;f=f?a.map(f,function(k){return typeof k==="string"?b.key?k.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+p+'="'+b.key+'" $2'):k:A(k,b,k._ctnt)}):b;if(c)return f;f=f.join("");f.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(k,o,t,w){d=a(t).get();r(d);if(o)d=F(o).concat(d);if(w)d=d.concat(F(w))});return d?d:F(f)}function F(b){var c=document.createElement("div");c.innerHTML=b;return a.makeArray(c.childNodes)}function H(b){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(c,f,d,k,o,t,w){c=a.tmpl.tag[d];if(!c)throw"Unknown template tag: "+d;d=c._default||[];if(t&&!/\w$/.test(o)){o+=t;t=""}if(o){o=B(o);w=w?","+B(w)+")":t?")":"";w=t?o.indexOf(".")>-1?o+B(t):"("+o+").call($item"+w:o;t=t?w:"(typeof("+o+")==='function'?("+o+").call($item):("+o+"))"}else t=w=d.$1||"null";k=B(k);return"');"+c[f?"close":"open"].split("$notnull_1").join(o?"typeof("+o+")!=='undefined' && ("+o+")!=null":"true").split("$1a").join(t).split("$1").join(w).split("$2").join(k||d.$2||"")+"__.push('"})+
"');}return __;")}function x(b,c){b._wrap=A(b,true,a.isArray(c)?c:[v.test(c)?c:a(c).html()]).join("")}function B(b){return b?b.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function r(b){function c(E){function M(L){L+=f;u=o[L]=o[L]||D(u,l[u.parent.key+f]||u.parent)}var C,y=E,u,I;if(I=E.getAttribute(p)){for(;y.parentNode&&(y=y.parentNode).nodeType===1&&!(C=y.getAttribute(p)););if(C!==I){y=y.parentNode?y.nodeType===11?0:y.getAttribute(p)||0:0;if(!(u=l[I])){u=s[I];u=D(u,l[y]||s[y]);u.key=++n;l[n]=u}e&&
M(I)}E.removeAttribute(p)}else if(e&&(u=a.data(E,"tmplItem"))){M(u.key);l[u.key]=u;y=(y=a.data(E.parentNode,"tmplItem"))?y.key:0}if(u){for(C=u;C&&C.key!=y;){C.nodes.push(E);C=C.parent}delete u._ctnt;delete u._wrap;a.data(E,"tmplItem",u)}}var f="_"+e,d,k,o={},t,w,G;t=0;for(w=b.length;t<w;t++)if((d=b[t]).nodeType===1){k=d.getElementsByTagName("*");for(G=k.length-1;G>=0;G--)c(k[G]);c(d)}}function K(b,c,f,d){if(!b)return q.pop();q.push({_:b,tmpl:c,item:this,data:f,options:d})}function g(b,c,f){return a.tmpl(a.template(b),
c,f,this)}function i(b,c){var f=b.options||{};f.wrapped=c;return a.tmpl(a.template(b.tmpl),b.data,f,b.item)}function j(b,c){var f=this._wrap;return a.map(a(a.isArray(f)?f.join(""):f).filter(b||"*"),function(d){if(c)d=d.innerText||d.textContent;else{var k;if(!(k=d.outerHTML)){k=document.createElement("div");k.appendChild(d.cloneNode(true));k=k.innerHTML}d=k}return d})}function h(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}var m=a.fn.domManip,p="_tmplitem",v=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
l={},s={},z,J={key:0,data:{}},n=0,e=0,q=[];a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,c){a.fn[b]=function(f){var d=[];f=a(f);var k,o,t;k=this.length===1&&this[0].parentNode;z=l||{};if(k&&k.nodeType===11&&k.childNodes.length===1&&f.length===1){f[c](this[0]);d=this}else{o=0;for(t=f.length;o<t;o++){e=o;k=(o>0?this.clone(true):this).get();a(f[o])[c](k);d=d.concat(k)}e=0;d=this.pushStack(d,b,f.selector)}f=z;z=null;a.tmpl.complete(f);
return d}});a.fn.extend({tmpl:function(b,c,f){return a.tmpl(this[0],b,c,f)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(b,c,f){if(b[0]&&a.isArray(b[0])){for(var d=a.makeArray(arguments),k=b[0],o=k.length,t=0,w;t<o&&!(w=a.data(k[t++],"tmplItem")););if(w&&e)d[2]=function(G){a.tmpl.afterManip(this,G,f)};m.apply(this,d)}else m.apply(this,arguments);e=0;z||a.tmpl.complete(l);return this}});a.extend({tmpl:function(b,c,f,d){var k=!d;
if(k){d=J;b=a.template[b]||a.template(null,b);s={}}else if(!b){b=d.tmpl;l[d.key]=d;d.nodes=[];d.wrapped&&x(d,d.wrapped);return a(A(d,null,d.tmpl(a,d)))}if(!b)return[];if(typeof c==="function")c=c.call(d||{});f&&f.wrapped&&x(f,f.wrapped);c=a.isArray(c)?a.map(c,function(o){return o?D(f,d,b,o):null}):[D(f,d,b,c)];return k?a(A(d,null,c)):c},tmplItem:function(b){var c;if(b instanceof a)b=b[0];for(;b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode););return c||J},template:function(b,c){if(c){if(typeof c===
"string")c=H(c);else if(c instanceof a)c=c[0]||{};if(c.nodeType)c=a.data(c,"tmpl")||a.data(c,"tmpl",H(c.innerHTML));return typeof b==="string"?a.template[b]=c:c}return b?typeof b!=="string"?a.template(null,b):a.template[b]||a.template(null,v.test(b)?b:a(b)):null},encode:function(b){return(""+b).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},
wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){l=
{}},afterManip:function(b,c,f){var d=c.nodeType===11?a.makeArray(c.childNodes):c.nodeType===1?[c]:[];f.call(b,c);r(d);e++}})})(jQuery);
(function(){var a,D,A,F,H,x,B,r,K=function(g,i){return function(){return g.apply(i,arguments)}};r=this;a=r.jQuery;r.pte=x=x||{};(function(g){return g.fixThickbox=function(i){var j,h,m,p;j=i.jQuery;if(!(j===null||i.frames.length<1)){log("===== FIXING THICKBOX =====");p=r.options.pte_tb_width+30;m=r.options.pte_tb_height+38;h=j("#TB_window");if(!(h.width()>=p&&h.height()>=m)){log("THICKBOX: "+h.width()+" x "+h.height());h.css({"margin-left":0-p/2,width:p,height:m}).children("iframe").css({width:p});
return i.setTimeout(function(){if(!(j("iframe",h).height()>m)){j("iframe",h).css({height:m});log("THICKBOX: "+h.width()+" x "+h.height());return true}},1E3)}}}})(x);B=function(g){return{}.toString.call(g).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()};D=function(){function g(i){this.message=i;this.date=new Date}g.prototype.toString=function(){var i,j,h,m,p,v,l;v=function(s,z){for(;(""+s).length<z;)s="0"+s;return s};h=this.date;l=v(h.getUTCFullYear(),4);j=v(h.getUTCMonth()+1,2);i=v(h.getUTCDate(),2);m=
v(h.getUTCHours(),2);p=v(h.getUTCMinutes(),2);v=v(h.getUTCSeconds(),2);switch(B(this.message)){case "string":h=this.message;break;default:h=a.toJSON(this.message)}return""+l+j+i+" "+m+":"+p+":"+v+" - ["+B(this.message)+"] "+h};return g}();(function(g){g.messages=[];g.log=function(i){if(!r.options.pte_debug)return true;try{g.messages.push(new D(i));console.log(i)}catch(j){}};g.formatLog=function(){var i,j,h,m,p;i="";p=g.messages;h=0;for(m=p.length;h<m;h++){j=p[h];i+=""+j+"\n"}return i};g.parseServerLog=
function(i){var j,h,m;log("===== SERVER LOG =====");h=0;for(m=i.length;h<m;h++){j=i[h];log(j)}return true};g.sendToPastebin=function(i){return a.ajax({url:"http://dpastey.appspot.com/",data:{title:"PostThumbnailEditor Log",content:i,lexer:"text",format:"json",expire_options:"2592000"},dataType:"json",global:false,type:"POST",error:function(j,h,m){a("#pte-log").fadeOut("900");alert("Sorry, there was a problem trying to send to pastebin");log(j);log(h);return log(m)},success:function(j){a("#pte-log").fadeOut("900");
return prompt("PASTEBIN URL:",j.url)}})};return true})(x);r.log=x.log;a(document).ready(function(g){g("#pte-log-tools a").click(function(i){return i.preventDefault()});g("#pastebin").click(function(){return x.sendToPastebin(x.formatLog())});g("#clear-log").click(function(){x.messages=[];return g("#pte-log-messages textarea").val(x.formatLog())});g("#close-log").click(function(){return g("#pte-log").fadeOut("900")});return g("body").delegate(".show-log-messages","click",function(i){i.preventDefault();
g("#pte-log-messages textarea").val(x.formatLog());return g("#pte-log").fadeIn("900")})});(function(g){return g.admin=function(){var i,j,h,m,p,v;v="&TB_iframe=true&height="+r.options.pte_tb_height+"&width="+r.options.pte_tb_width;h=null;p=function(l){l=l||h||a("#attachment-id").val();return""+ajaxurl+"?action=pte_ajax&pte-action=launch&id="+l+v};i=function(l){return a('<a class="thickbox" href="'+p(l)+'">'+objectL10n.PTE+"</a>")};j=function(l){log("Start PTE...");if(r.parent.frames.length>0){log("Modifying thickbox...");
K(function(){r.parent.tb_click();return true},this)();return l.stopPropagation()}};m=function(){var l;l=a("#imgedit-save-target-"+h);if((l!=null?l.size():void 0)<1){r.log("Edit Thumbnail Menu not visible, waiting for 300ms");r.setTimeout(m,300);return false}return l.append(i().click(j))};return function(){a(".media-item").each(function(l,s){var z;z=s.id.replace("media-item-","");return i(z).css({"font-size":".8em","margin-left":"5px"}).click(j).appendTo(a("tr.image-size th.label",s))});if(imageEdit.open!=
null){imageEdit.oldopen=imageEdit.open;imageEdit.open=function(l,s){h=l;imageEdit.oldopen(l,s);return m()}}return true}()}})(x);A=function(){function g(i,j){this.fn=i;this.timeout=j;this.doFunc=K(this.doFunc,this);this.timer=null}g.prototype.doFunc=function(){r.clearTimeout(this.timer);this.timer=r.setTimeout(this.fn,this.timeout);return true};return g}();r.randomness=function(){return Math.floor(Math.random()*1000001).toString(16)};r.debugTmpl=function(g){log("===== TEMPLATE DEBUG DATA FOLLOWS =====");
log(g);return true};r.goBack=function(g){g!=null&&g.preventDefault();return a("#stage2").animate({left:1200},500,"swing",function(){a(this).hide();return a("#stage1").show(0,function(){return a(this).animate({left:0},500,"swing",function(){var i;i={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"delete-images","pte-nonce":a("#pte-delete-nonce").val()};return a.ajax({url:ajaxurl,data:i,global:false,dataType:"json",success:function(j){log("===== DELETE SUCCESSFUL, DATA DUMP FOLLOWS =====");
log(j);return x.parseServerLog(j.log)}})})})})};H=function(g,i){if(g===0)return i;for(;i>0;)if(g>i)g-=i;else i-=g;if(g<0||i<0)return null;return g};F=function(g,i){var j,h,m,p;h=thumbnail_info[i];j=h.crop;p=h.width;m=h.height;j=+j;p=+p;m=+m;h=H(p,m);if(j!=null&&j>0){j=null;if((p!=null)>0&&(m!=null)>0)j=h!=null?""+p/h+":"+m/h:""+p+":"+m;if(g!=null&&j!=null&&j!==g)throw"Too many Aspect Ratios. Disabling";return j}};(function(g){var i,j,h,m,p,v,l,s,z,J;g.editor=function(){var n,e;J();h();z();j();m();
p();i();n=a("#pte-loading");e=function(){n.hide();return true};a("#pte-preview").load(e);n.ajaxStart(function(){return a(this).fadeIn(200)}).ajaxStop(function(){return a(this).fadeOut(200)});r.setTimeout(e,2E3);return true};J=function(){var n;n=new A(function(){var e;log("===== REFLOW =====");g.fixThickbox(r.parent);e=a("#pte-sizes").offset();e=a(r).height()-e.top-2;return a("#pte-sizes").height(e)},100);a(r).resize(n.doFunc).load(n.doFunc);return true};h=function(){var n;n=function(e){e.delegate("tr",
"click",function(q){q.target.type!=="checkbox"&&a("input:checkbox",this).click();return true});return e.delegate("input:checkbox","click",function(){this.checked||a(this).is("input:checked")?a(this).parents("tr").first().removeClass("selected"):a(this).parents("tr").first().addClass("selected");return true})};n(a("#stage2"));return n(a("#stage1"))};s=null;l={keys:true,minWidth:3,minHeight:3,handles:true,zIndex:1200,instance:true,onSelectEnd:function(n,e){return e.width&&e.width>0&&e.height&&e.height>
0&&a(".pte-size").filter(":checked").size()>0?a("#pte-submit").removeAttr("disabled"):a("#pte-submit").attr("disabled",true)}};z=function(){return s=a("#pte-image img").imgAreaSelect(l)};v=function(n){log("===== SETTING ASPECTRATIO: "+n+" =====");s.setOptions({aspectRatio:n});return s.update()};j=function(){var n;n=new A(function(){var e;e=null;a("input.pte-size").filter(":checked").each(function(q,b){try{e=F(e,a(b).val())}catch(c){e=null;e!==s.getOptions().aspectRatio&&alert(c);return false}return true});
v(e);l.onSelectEnd(null,s.getSelection());return true},50);return a("input.pte-size").click(n.doFunc)};m=function(){var n;a("#pte-submit").click(function(){var e,q;q=s.getSelection();e=a("#pte-sizer").val();e={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"resize-images","pte-sizes[]":a(".pte-size").filter(":checked").map(function(){return a(this).val()}).get(),x:Math.floor(q.x1/e),y:Math.floor(q.y1/e),w:Math.floor(q.width/e),h:Math.floor(q.height/e)};log("===== RESIZE-IMAGES =====");
log(e);s.setOptions({hide:true,x1:0,y1:0,x2:0,y2:0});a("#pte-submit").attr("disabled",true);a.getJSON(ajaxurl,e,n);return true});return n=function(e){log("===== RESIZE-IMAGES SUCCESS =====");log(e);g.parseServerLog(e.log);if(e.error!=null&&e.thumbnails==null)alert(e.error);else{a("#stage1").animate({left:-a(r).width()},500,"swing",function(){a(this).hide();a("#stage2").html(a("#stage2template").tmpl(e)).show(0,function(){a(this).animate({left:0},500);return true});return true});return false}}};p=
function(){var n;a("#pte-confirm").live("click",function(){var e,q;q={};a("input.pte-confirm").filter(":checked").each(function(b,c){var f;f=a(c).val();return q[f]=a("#pte-"+f+"-file").val()});e={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"confirm-images","pte-nonce":a("#pte-nonce").val(),"pte-confirm":q};log("===== CONFIRM-IMAGES =====");log(e);return a.getJSON(ajaxurl,e,n)});return n=function(e){log("===== CONFIRM-IMAGES SUCCESS =====");log(e);g.parseServerLog(e.log);a("#stage2").animate({left:-a(r).width()},
500,"swing",function(){a(this).hide();a("#stage3").html(a("#stage3template").tmpl(e)).show(0,function(){a(this).animate({left:0},500);return true});return true});return false}};return i=function(){var n,e;e=function(q){var b,c;q!=null&&q.preventDefault();q=(b=(c=q.data)!=null?c.selector:void 0)!=null?b:".pte-size";return a(q).filter(":checked").click()};n=function(q){var b,c;q!=null&&q.preventDefault();q=(b=q!=null?(c=q.data)!=null?c.selector:void 0:void 0)!=null?b:".pte-size";return a(q).not(":checked").click()};
a("#pte-selectors .all").click(n);a("#pte-selectors .none").click(e).click();a("#stage2").delegate("#pte-stage2-selectors .all","click",{selector:".pte-confirm"},n);a("#stage2").delegate("#pte-stage2-selectors .none","click",{selector:".pte-confirm"},e);return true}})(x)}).call(this);
