(function(a){function u(c,h,g,e){e={data:e||e===0||e===!1?e:h?h.data:{},_wrap:h?h._wrap:null,tmpl:null,parent:h||null,nodes:[],calls:d,nest:k,wrap:j,html:l,update:m};c&&a.extend(e,c,{nodes:[],parent:h});if(g)e.tmpl=g,e._ctnt=e._ctnt||e.tmpl(a,e),e.key=++i,(A.length?z:o)[i]=e;return e}function w(c,h,g){var e,g=g?a.map(g,function(a){return typeof a==="string"?c.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+q+'="'+c.key+'" $2'):a:w(a,c,a._ctnt)}):c;if(h)return g;g=g.join("");g.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(c,h,g,B){e=a(g).get();b(e);h&&(e=y(h).concat(e));B&&(e=e.concat(y(B)))});return e?e:y(g)}function y(c){var h=document.createElement("div");h.innerHTML=c;return a.makeArray(h.childNodes)}function s(c){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+a.trim(c).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(c,g,e,p,n,i,b){c=a.tmpl.tag[e];if(!c)throw"Unknown template tag: "+e;e=c._default||[];i&&!/\w$/.test(n)&&(n+=i,i="");n?(n=x(n),b=b?","+x(b)+")":i?")":"",b=i?n.indexOf(".")>-1?n+x(i):"("+n+").call($item"+b:n,i=i?b:"(typeof("+n+")==='function'?("+n+").call($item):("+n+"))"):i=b=e.$1||"null";p=x(p);return"');"+c[g?"close":"open"].split("$notnull_1").join(n?"typeof("+n+")!=='undefined' && ("+n+")!=null":"true").split("$1a").join(i).split("$1").join(b).split("$2").join(p||e.$2||"")+"__.push('"})+
"');}return __;")}function f(c,h){c._wrap=w(c,!0,a.isArray(h)?h:[r.test(h)?h:a(h).html()]).join("")}function x(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function b(c){function h(c){function h(a){var n;a+=g;n=p[a]=p[a]||u(d,o[d.parent.key+g]||d.parent),d=n}var e,b=c,d,f;if(f=c.getAttribute(q)){for(;b.parentNode&&(b=b.parentNode).nodeType===1&&!(e=b.getAttribute(q)););if(e!==f){b=b.parentNode?b.nodeType===11?0:b.getAttribute(q)||0:0;if(!(d=o[f]))d=z[f],d=u(d,o[b]||z[b]),d.key=++i,
o[i]=d;v&&h(f)}c.removeAttribute(q)}else if(v&&(d=a.data(c,"tmplItem")))h(d.key),o[d.key]=d,b=(b=a.data(c.parentNode,"tmplItem"))?b.key:0;if(d){for(e=d;e&&e.key!=b;)e.nodes.push(c),e=e.parent;delete d._ctnt;delete d._wrap;a.data(c,"tmplItem",d)}}var g="_"+v,e,b,p={},d,k,f;d=0;for(k=c.length;d<k;d++)if((e=c[d]).nodeType===1){b=e.getElementsByTagName("*");for(f=b.length-1;f>=0;f--)h(b[f]);h(e)}}function d(a,h,g,e){if(!a)return A.pop();A.push({_:a,tmpl:h,item:this,data:g,options:e})}function k(c,h,g){return a.tmpl(a.template(c),
h,g,this)}function j(c,g){var b=c.options||{};b.wrapped=g;return a.tmpl(a.template(c.tmpl),c.data,b,c.item)}function l(c,g){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(""):b).filter(c||"*"),function(a){if(g)a=a.innerText||a.textContent;else{var c;if(!(c=a.outerHTML))c=document.createElement("div"),c.appendChild(a.cloneNode(!0)),c=c.innerHTML;a=c}return a})}function m(){var c=this.nodes;a.tmpl(null,null,null,this).insertBefore(c[0]);a(c).remove()}var t=a.fn.domManip,q="_tmplitem",r=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
o={},z={},p,g={key:0,data:{}},i=0,v=0,A=[];a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(c,g){a.fn[c]=function(b){var e=[],b=a(b),d,i,f;d=this.length===1&&this[0].parentNode;p=o||{};if(d&&d.nodeType===11&&d.childNodes.length===1&&b.length===1)b[g](this[0]),e=this;else{i=0;for(f=b.length;i<f;i++)v=i,d=(i>0?this.clone(!0):this).get(),a(b[i])[g](d),e=e.concat(d);v=0;e=this.pushStack(e,c,b.selector)}b=p;p=null;a.tmpl.complete(b);
return e}});a.fn.extend({tmpl:function(c,g,b){return a.tmpl(this[0],c,g,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(c){return a.template(c,this[0])},domManip:function(c,g,b,e){if(c[0]&&a.isArray(c[0])){for(var d=a.makeArray(arguments),i=c[0],f=i.length,k=0,q;k<f&&!(q=a.data(i[k++],"tmplItem")););q&&v&&(d[2]=function(c){a.tmpl.afterManip(this,c,b)});t.apply(this,d)}else t.apply(this,arguments);v=0;p||a.tmpl.complete(o);return this}});a.extend({tmpl:function(c,b,d,e){var i=
!e;if(i)e=g,c=a.template[c]||a.template(null,c),z={};else if(!c)return c=e.tmpl,o[e.key]=e,e.nodes=[],e.wrapped&&f(e,e.wrapped),a(w(e,null,e.tmpl(a,e)));if(!c)return[];typeof b==="function"&&(b=b.call(e||{}));d&&d.wrapped&&f(d,d.wrapped);b=a.isArray(b)?a.map(b,function(a){return a?u(d,e,c,a):null}):[u(d,e,c,b)];return i?a(w(e,null,b)):b},tmplItem:function(c){var b;for(c instanceof a&&(c=c[0]);c&&c.nodeType===1&&!(b=a.data(c,"tmplItem"))&&(c=c.parentNode););return b||g},template:function(c,b){return b?
(typeof b==="string"?b=s(b):b instanceof a&&(b=b[0]||{}),b.nodeType&&(b=a.data(b,"tmpl")||a.data(b,"tmpl",s(b.innerHTML))),typeof c==="string"?a.template[c]=b:b):c?typeof c!=="string"?a.template(null,c):a.template[c]||a.template(null,r.test(c)?c:a(c)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},
open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){o={}},afterManip:function(c,
g,d){var e=g.nodeType===11?a.makeArray(g.childNodes):g.nodeType===1?[g]:[];d.call(c,g);b(e);v++}})})(jQuery);
(function(){var a,u,w,y,s,f,x=function(a,d){return function(){return a.apply(d,arguments)}};f=this;a=f.jQuery;f.pte=s=s||{};f.log=function(a){if(!f.debug_enabled)return!0;try{console.log(a)}catch(d){alert(a)}return!0};(function(b){return b.admin=function(){var b,k,j,l,m,t;t="&TB_iframe=true&height="+pte_tb_height+"&width="+pte_tb_width;j=null;m=function(){var b;b=j||a("#attachment-id").val();return""+ajaxurl+"?action=pte_ajax&pte-action=launch&id="+b+t};k=function(a){var b,d,f;d=a.jQuery;if(d!==null)return log("Got thickbox"),
f=pte_tb_width+40,b=pte_tb_height,t=d("#TB_window").css({"margin-left":0-f/2,width:f}).children("iframe").css({width:f}),a.setTimeout(function(){return d("iframe",t).css({height:b+100})},1E3)};b=function(a){log("Start PTE...");if(f.parent.frames.length>0)return log("Modifying thickbox..."),x(function(){if(j==null)log("Error finding ID...");else return f.parent.tb_click(),k(f.parent),!0},this)(),a.stopPropagation()};l=function(){var k;k=a('p[id^="imgedit-save-target-'+j+'"]');return(k!=null?k.size():
void 0)<1?(f.log("Edit Thumbnail Menu not visible, waiting for 300ms"),f.setTimeout(l,300),!1):k.append(a('<a class="thickbox" href="'+m()+'">'+objectL10n.PTE+"</a>").click(b))};return function(){if(imageEdit.open!=null)imageEdit.oldopen=imageEdit.open,imageEdit.open=function(a,b){j=a;imageEdit.oldopen(a,b);return l()};return!0}()}})(s);u=function(){function a(b,f){this.fn=b;this.timeout=f;this.doFunc=x(this.doFunc,this);this.timer=null}a.prototype.doFunc=function(){f.clearTimeout(this.timer);this.timer=
f.setTimeout(this.fn,this.timeout);return!0};return a}();f.randomness=function(){return Math.floor(Math.random()*1000001).toString(16)};f.debugTmpl=function(a){log(a);return!0};f.goBack=function(b){b!=null&&b.preventDefault();return a("#stage2").animate({left:1200},500,"swing",function(){a(this).hide();return a("#stage1").show(0,function(){return a(this).animate({left:0},500,"swing",function(){var b;log("okay cleanup");b={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"delete-images","pte-nonce":a("#pte-delete-nonce").val()};
return a.ajax({url:ajaxurl,data:b,global:!1,dataType:"json",success:function(a){return a.error!=null?log(a.error):log("Deleted tmp files")}})})})})};y=function(a,d){if(a===0)return d;for(;d>0;)a>d?a-=d:d-=a;return a<0||d<0?null:a};w=function(a,d){var f,j,l,m;j=thumbnail_info[d];f=j.crop;m=j.width;l=j.height;f=+f;m=+m;l=+l;j=y(m,l);if(f!=null&&f>0){f=null;(m!=null)>0&&(l!=null)>0&&(f=j!=null?""+m/j+":"+l/j:""+m+":"+l);if(a!=null&&f!=null&&f!==a)throw"Too many Aspect Ratios. Disabling";return f}};(function(b){var d,
k,j,l,m,t,q,r,o,s;b.editor=function(){var b,g;s();j();o();k();l();m();d();b=a("#pte-loading");g=function(){log("Closing load screen");b.hide();return!0};a("#pte-preview").load(g);b.ajaxStart(function(){return a(this).fadeIn(200)}).ajaxStop(function(){return a(this).fadeOut(200)});f.setTimeout(g,2E3);return!0};s=function(){var b;b=new u(function(){var b;log("reflow called...");b=a("#pte-sizes").offset();b=a(f).height()-b.top-2;return a("#pte-sizes").height(b)},100);return a(f).resize(b.doFunc).load(b.doFunc)};
j=function(){var b;b=function(b){b.delegate("tr","click",function(b){b.target.type!=="checkbox"&&a("input:checkbox",this).click();return!0});return b.delegate("input:checkbox","click",function(){this.checked||a(this).is("input:checked")?a(this).parents("tr").first().removeClass("selected"):a(this).parents("tr").first().addClass("selected");return!0})};b(a("#stage2"));return b(a("#stage1"))};r=null;q={keys:!0,minWidth:3,minHeight:3,handles:!0,zIndex:1200,instance:!0,onSelectEnd:function(b,g){return g.width&&
g.width>0&&g.height&&g.height>0&&a(".pte-size").filter(":checked").size()>0?(log("Enabling button"),a("#pte-submit").removeAttr("disabled")):(log("Disabling button"),a("#pte-submit").attr("disabled",!0))}};o=function(){return r=a("#pte-image img").imgAreaSelect(q)};t=function(a){log("setting aspectRatio: "+a);r.setOptions({aspectRatio:a});return r.update()};k=function(){var b;b=new u(function(){var b;b=null;a("input.pte-size").filter(":checked").each(function(d,f){try{b=w(b,a(f).val())}catch(p){return b=
null,b!==r.getOptions().aspectRatio&&alert(p),!1}return!0});t(b);q.onSelectEnd(null,r.getSelection());return!0},50);return a("input.pte-size").click(b.doFunc)};l=function(){var b;a("#pte-submit").click(function(){var g,d;log("Clicked Submit...");d=r.getSelection();g=a("#pte-sizer").val();g={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"resize-images","pte-sizes[]":a(".pte-size").filter(":checked").map(function(){return a(this).val()}).get(),x:Math.floor(d.x1/g),y:Math.floor(d.y1/g),w:Math.floor(d.width/
g),h:Math.floor(d.height/g)};log(g);r.setOptions({hide:!0,x1:0,y1:0,x2:0,y2:0});a("#pte-submit").attr("disabled",!0);a.getJSON(ajaxurl,g,b);return!0});return b=function(b){log(b);if(b.error!=null&&b.thumbnails==null)alert(b.error);else return a("#stage1").animate({left:-a(f).width()},500,"swing",function(){a(this).hide();a("#stage2").html(a("#stage2template").tmpl(b)).show(0,function(){a(this).animate({left:0},500);return!0});return!0}),!1}};m=function(){var b;a("#pte-confirm").live("click",function(){var d,
f;log("Confirming");f={};a("input.pte-confirm").filter(":checked").each(function(b,d){var c;c=a(d).val();return f[c]=a("#pte-"+c+"-file").val()});d={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"confirm-images","pte-nonce":a("#pte-nonce").val(),"pte-confirm":f};log(d);return a.getJSON(ajaxurl,d,b)});return b=function(b){log(b);a("#stage2").animate({left:-a(f).width()},500,"swing",function(){a(this).hide();a("#stage3").html(a("#stage3template").tmpl(b)).show(0,function(){a(this).animate({left:0},
500);return!0});return!0});return!1}};return d=function(){var b,d;d=function(b){var c;var d,f;b!=null&&b.preventDefault();c=(d=(f=b.data)!=null?f.selector:void 0)!=null?d:".pte-size",b=c;return a(b).filter(":checked").click()};b=function(b){var c;var d,f;b!=null&&b.preventDefault();c=(d=b!=null?(f=b.data)!=null?f.selector:void 0:void 0)!=null?d:".pte-size",b=c;return a(b).not(":checked").click()};a("#pte-selectors .all").click(b);a("#pte-selectors .none").click(d).click();a("#stage2").delegate("#pte-stage2-selectors .all",
"click",{selector:".pte-confirm"},b);a("#stage2").delegate("#pte-stage2-selectors .none","click",{selector:".pte-confirm"},d);return!0}})(s)}).call(this);
