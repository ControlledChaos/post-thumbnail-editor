(function(a){function A(b,c,f,d){d={data:d||d===0||d===false?d:c?c.data:{},_wrap:c?c._wrap:null,tmpl:null,parent:c||null,nodes:[],calls:m,nest:k,wrap:n,html:r,update:s};b&&a.extend(d,b,{nodes:[],parent:c});if(f){d.tmpl=f;d._ctnt=d._ctnt||d.tmpl(a,d);d.key=++l;(z.length?E:w)[l]=d}return d}function F(b,c,f){var d;f=f?a.map(f,function(g){return typeof g==="string"?b.key?g.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+o+'="'+b.key+'" $2'):g:F(g,b,g._ctnt)}):b;if(c)return f;f=f.join("");f.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(g,h,p,u){d=a(p).get();j(d);if(h)d=I(h).concat(d);if(u)d=d.concat(I(u))});return d?d:I(f)}function I(b){var c=document.createElement("div");c.innerHTML=b;return a.makeArray(c.childNodes)}function B(b){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(c,f,d,g,h,p,u){c=a.tmpl.tag[d];if(!c)throw"Unknown template tag: "+d;d=c._default||[];if(p&&!/\w$/.test(h)){h+=p;p=""}if(h){h=G(h);u=u?","+G(u)+")":p?")":"";u=p?h.indexOf(".")>-1?h+G(p):"("+h+").call($item"+u:h;p=p?u:"(typeof("+h+")==='function'?("+h+").call($item):("+h+"))"}else p=u=d.$1||"null";g=G(g);return"');"+c[f?"close":"open"].split("$notnull_1").join(h?"typeof("+h+")!=='undefined' && ("+h+")!=null":"true").split("$1a").join(p).split("$1").join(u).split("$2").join(g||d.$2||"")+"__.push('"})+
"');}return __;")}function q(b,c){b._wrap=F(b,true,a.isArray(c)?c:[x.test(c)?c:a(c).html()]).join("")}function G(b){return b?b.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function j(b){function c(H){function M(L){L+=f;t=h[L]=h[L]||A(t,w[t.parent.key+f]||t.parent)}var C,y=H,t,K;if(K=H.getAttribute(o)){for(;y.parentNode&&(y=y.parentNode).nodeType===1&&!(C=y.getAttribute(o)););if(C!==K){y=y.parentNode?y.nodeType===11?0:y.getAttribute(o)||0:0;if(!(t=w[K])){t=E[K];t=A(t,w[y]||E[y]);t.key=++l;w[l]=t}v&&
M(K)}H.removeAttribute(o)}else if(v&&(t=a.data(H,"tmplItem"))){M(t.key);w[t.key]=t;y=(y=a.data(H.parentNode,"tmplItem"))?y.key:0}if(t){for(C=t;C&&C.key!=y;){C.nodes.push(H);C=C.parent}delete t._ctnt;delete t._wrap;a.data(H,"tmplItem",t)}}var f="_"+v,d,g,h={},p,u,J;p=0;for(u=b.length;p<u;p++)if((d=b[p]).nodeType===1){g=d.getElementsByTagName("*");for(J=g.length-1;J>=0;J--)c(g[J]);c(d)}}function m(b,c,f,d){if(!b)return z.pop();z.push({_:b,tmpl:c,item:this,data:f,options:d})}function k(b,c,f){return a.tmpl(a.template(b),
c,f,this)}function n(b,c){var f=b.options||{};f.wrapped=c;return a.tmpl(a.template(b.tmpl),b.data,f,b.item)}function r(b,c){var f=this._wrap;return a.map(a(a.isArray(f)?f.join(""):f).filter(b||"*"),function(d){if(c)d=d.innerText||d.textContent;else{var g;if(!(g=d.outerHTML)){g=document.createElement("div");g.appendChild(d.cloneNode(true));g=g.innerHTML}d=g}return d})}function s(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}var D=a.fn.domManip,o="_tmplitem",x=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
w={},E={},i,e={key:0,data:{}},l=0,v=0,z=[];a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,c){a.fn[b]=function(f){var d=[];f=a(f);var g,h,p;g=this.length===1&&this[0].parentNode;i=w||{};if(g&&g.nodeType===11&&g.childNodes.length===1&&f.length===1){f[c](this[0]);d=this}else{h=0;for(p=f.length;h<p;h++){v=h;g=(h>0?this.clone(true):this).get();a(f[h])[c](g);d=d.concat(g)}v=0;d=this.pushStack(d,b,f.selector)}f=i;i=null;a.tmpl.complete(f);
return d}});a.fn.extend({tmpl:function(b,c,f){return a.tmpl(this[0],b,c,f)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(b,c,f){if(b[0]&&a.isArray(b[0])){for(var d=a.makeArray(arguments),g=b[0],h=g.length,p=0,u;p<h&&!(u=a.data(g[p++],"tmplItem")););if(u&&v)d[2]=function(J){a.tmpl.afterManip(this,J,f)};D.apply(this,d)}else D.apply(this,arguments);v=0;i||a.tmpl.complete(w);return this}});a.extend({tmpl:function(b,c,f,d){var g=!d;
if(g){d=e;b=a.template[b]||a.template(null,b);E={}}else if(!b){b=d.tmpl;w[d.key]=d;d.nodes=[];d.wrapped&&q(d,d.wrapped);return a(F(d,null,d.tmpl(a,d)))}if(!b)return[];if(typeof c==="function")c=c.call(d||{});f&&f.wrapped&&q(f,f.wrapped);c=a.isArray(c)?a.map(c,function(h){return h?A(f,d,b,h):null}):[A(f,d,b,c)];return g?a(F(d,null,c)):c},tmplItem:function(b){var c;if(b instanceof a)b=b[0];for(;b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode););return c||e},template:function(b,c){if(c){if(typeof c===
"string")c=B(c);else if(c instanceof a)c=c[0]||{};if(c.nodeType)c=a.data(c,"tmpl")||a.data(c,"tmpl",B(c.innerHTML));return typeof b==="string"?a.template[b]=c:c}return b?typeof b!=="string"?a.template(null,b):a.template[b]||a.template(null,x.test(b)?b:a(b)):null},encode:function(b){return(""+b).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},
wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){w=
{}},afterManip:function(b,c,f){var d=c.nodeType===11?a.makeArray(c.childNodes):c.nodeType===1?[c]:[];f.call(b,c);j(d);v++}})})(jQuery);
(function(){var a,A,F,I,B,q,G=function(j,m){return function(){return j.apply(m,arguments)}};q=this;a=q.jQuery;q.pte=B=B||{};(function(j){return j.fixThickbox=function(m){var k,n,r,s;k=m.jQuery;if(!(k===null||m.frames.length<1)){log("Fixing thickbox");s=pte_tb_width+30;r=pte_tb_height+38;n=k("#TB_window");if(!(n.width()>=s&&n.height()>=r)){log("THICKBOX: "+n.width()+" x "+n.height());n.css({"margin-left":0-s/2,width:s,height:r}).children("iframe").css({width:s});return m.setTimeout(function(){if(!(k("iframe",
n).height()>r)){k("iframe",n).css({height:r});log("THICKBOX: "+n.width()+" x "+n.height());return true}},1E3)}}}})(B);q.log=function(j){if(!q.debug_enabled)return true;try{console.log(j)}catch(m){alert(j)}return true};(function(j){return j.admin=function(){var m,k,n,r,s,D;D="&TB_iframe=true&height="+pte_tb_height+"&width="+pte_tb_width;n=null;s=function(o){o=o||n||a("#attachment-id").val();return""+ajaxurl+"?action=pte_ajax&pte-action=launch&id="+o+D};m=function(o){return a('<a class="thickbox" href="'+
s(o)+'">'+objectL10n.PTE+"</a>")};k=function(o){log("Start PTE...");if(q.parent.frames.length>0){log("Modifying thickbox...");G(function(){q.parent.tb_click();return true},this)();return o.stopPropagation()}};r=function(){var o;o=a("#imgedit-save-target-"+n);if((o!=null?o.size():void 0)<1){q.log("Edit Thumbnail Menu not visible, waiting for 300ms");q.setTimeout(r,300);return false}return o.append(m().click(k))};return function(){a(".media-item").each(function(o,x){var w;w=x.id.replace("media-item-",
"");return m(w).css({"font-size":".8em","margin-left":"5px"}).click(k).appendTo(a("tr.image-size th.label",x))});if(imageEdit.open!=null){imageEdit.oldopen=imageEdit.open;imageEdit.open=function(o,x){n=o;imageEdit.oldopen(o,x);return r()}}return true}()}})(B);A=function(){function j(m,k){this.fn=m;this.timeout=k;this.doFunc=G(this.doFunc,this);this.timer=null}j.prototype.doFunc=function(){q.clearTimeout(this.timer);this.timer=q.setTimeout(this.fn,this.timeout);return true};return j}();q.randomness=
function(){return Math.floor(Math.random()*1000001).toString(16)};q.debugTmpl=function(j){log(j);return true};q.goBack=function(j){j!=null&&j.preventDefault();return a("#stage2").animate({left:1200},500,"swing",function(){a(this).hide();return a("#stage1").show(0,function(){return a(this).animate({left:0},500,"swing",function(){var m;log("okay cleanup");m={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"delete-images","pte-nonce":a("#pte-delete-nonce").val()};return a.ajax({url:ajaxurl,
data:m,global:false,dataType:"json",success:function(k){return k.error!=null?log(k.error):log("Deleted tmp files")}})})})})};I=function(j,m){if(j===0)return m;for(;m>0;)if(j>m)j-=m;else m-=j;if(j<0||m<0)return null;return j};F=function(j,m){var k,n,r,s;n=thumbnail_info[m];k=n.crop;s=n.width;r=n.height;k=+k;s=+s;r=+r;n=I(s,r);if(k!=null&&k>0){k=null;if((s!=null)>0&&(r!=null)>0)k=n!=null?""+s/n+":"+r/n:""+s+":"+r;if(j!=null&&k!=null&&k!==j)throw"Too many Aspect Ratios. Disabling";return k}};(function(j){var m,
k,n,r,s,D,o,x,w,E;j.editor=function(){var i,e;E();n();w();k();r();s();m();i=a("#pte-loading");e=function(){log("Closing load screen");i.hide();return true};a("#pte-preview").load(e);i.ajaxStart(function(){return a(this).fadeIn(200)}).ajaxStop(function(){return a(this).fadeOut(200)});q.setTimeout(e,2E3);return true};E=function(){var i;i=new A(function(){var e;log("reflow called...");j.fixThickbox(q.parent);e=a("#pte-sizes").offset();e=a(q).height()-e.top-2;return a("#pte-sizes").height(e)},100);a(q).resize(i.doFunc).load(i.doFunc);
return true};n=function(){var i;i=function(e){e.delegate("tr","click",function(l){l.target.type!=="checkbox"&&a("input:checkbox",this).click();return true});return e.delegate("input:checkbox","click",function(){this.checked||a(this).is("input:checked")?a(this).parents("tr").first().removeClass("selected"):a(this).parents("tr").first().addClass("selected");return true})};i(a("#stage2"));return i(a("#stage1"))};x=null;o={keys:true,minWidth:3,minHeight:3,handles:true,zIndex:1200,instance:true,onSelectEnd:function(i,
e){if(e.width&&e.width>0&&e.height&&e.height>0&&a(".pte-size").filter(":checked").size()>0){log("Enabling button");return a("#pte-submit").removeAttr("disabled")}else{log("Disabling button");return a("#pte-submit").attr("disabled",true)}}};w=function(){return x=a("#pte-image img").imgAreaSelect(o)};D=function(i){log("setting aspectRatio: "+i);x.setOptions({aspectRatio:i});return x.update()};k=function(){var i;i=new A(function(){var e;e=null;a("input.pte-size").filter(":checked").each(function(l,v){try{e=
F(e,a(v).val())}catch(z){e=null;e!==x.getOptions().aspectRatio&&alert(z);return false}return true});D(e);o.onSelectEnd(null,x.getSelection());return true},50);return a("input.pte-size").click(i.doFunc)};r=function(){var i;a("#pte-submit").click(function(){var e,l;log("Clicked Submit...");l=x.getSelection();e=a("#pte-sizer").val();e={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"resize-images","pte-sizes[]":a(".pte-size").filter(":checked").map(function(){return a(this).val()}).get(),
x:Math.floor(l.x1/e),y:Math.floor(l.y1/e),w:Math.floor(l.width/e),h:Math.floor(l.height/e)};log(e);x.setOptions({hide:true,x1:0,y1:0,x2:0,y2:0});a("#pte-submit").attr("disabled",true);a.getJSON(ajaxurl,e,i);return true});return i=function(e){log(e);if(e.error!=null&&e.thumbnails==null)alert(e.error);else{a("#stage1").animate({left:-a(q).width()},500,"swing",function(){a(this).hide();a("#stage2").html(a("#stage2template").tmpl(e)).show(0,function(){a(this).animate({left:0},500);return true});return true});
return false}}};s=function(){var i;a("#pte-confirm").live("click",function(){var e,l;log("Confirming");l={};a("input.pte-confirm").filter(":checked").each(function(v,z){var b;b=a(z).val();return l[b]=a("#pte-"+b+"-file").val()});e={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"confirm-images","pte-nonce":a("#pte-nonce").val(),"pte-confirm":l};log(e);return a.getJSON(ajaxurl,e,i)});return i=function(e){log(e);a("#stage2").animate({left:-a(q).width()},500,"swing",function(){a(this).hide();
a("#stage3").html(a("#stage3template").tmpl(e)).show(0,function(){a(this).animate({left:0},500);return true});return true});return false}};return m=function(){var i,e;e=function(l){var v,z;l!=null&&l.preventDefault();l=(v=(z=l.data)!=null?z.selector:void 0)!=null?v:".pte-size";return a(l).filter(":checked").click()};i=function(l){var v,z;l!=null&&l.preventDefault();l=(v=l!=null?(z=l.data)!=null?z.selector:void 0:void 0)!=null?v:".pte-size";return a(l).not(":checked").click()};a("#pte-selectors .all").click(i);
a("#pte-selectors .none").click(e).click();a("#stage2").delegate("#pte-stage2-selectors .all","click",{selector:".pte-confirm"},i);a("#stage2").delegate("#pte-stage2-selectors .none","click",{selector:".pte-confirm"},e);return true}})(B)}).call(this);
