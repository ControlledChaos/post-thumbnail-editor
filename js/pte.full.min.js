(function(a){function s(e,i,d,f){f={data:f||f===0||f===!1?f:i?i.data:{},_wrap:i?i._wrap:null,tmpl:null,parent:i||null,nodes:[],calls:c,nest:b,wrap:k,html:l,update:j};e&&a.extend(f,e,{nodes:[],parent:i});if(d)f.tmpl=d,f._ctnt=f._ctnt||f.tmpl(a,f),f.key=++w,(z.length?y:n)[w]=f;return f}function u(e,i,d){var f,d=d?a.map(d,function(a){return typeof a==="string"?e.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+o+'="'+e.key+'" $2'):a:u(a,e,a._ctnt)}):e;if(i)return d;d=d.join("");d.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(e,i,d,A){f=a(d).get();g(f);i&&(f=x(i).concat(f));A&&(f=f.concat(x(A)))});return f?f:x(d)}function x(e){var i=document.createElement("div");i.innerHTML=e;return a.makeArray(i.childNodes)}function p(e){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+a.trim(e).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(e,d,f,m,b,g,c){e=a.tmpl.tag[f];if(!e)throw"Unknown template tag: "+f;f=e._default||[];g&&!/\w$/.test(b)&&(b+=g,g="");b?(b=v(b),c=c?","+v(c)+")":g?")":"",c=g?b.indexOf(".")>-1?b+v(g):"("+b+").call($item"+c:b,g=g?c:"(typeof("+b+")==='function'?("+b+").call($item):("+b+"))"):g=c=f.$1||"null";m=v(m);return"');"+e[d?"close":"open"].split("$notnull_1").join(b?"typeof("+b+")!=='undefined' && ("+b+")!=null":"true").split("$1a").join(g).split("$1").join(c).split("$2").join(m||f.$2||"")+"__.push('"})+
"');}return __;")}function h(e,i){e._wrap=u(e,!0,a.isArray(i)?i:[q.test(i)?i:a(i).html()]).join("")}function v(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function g(e){function i(e){function i(a){var A;a+=d;A=g[a]=g[a]||s(c,n[c.parent.key+d]||c.parent),c=A}var f,b=e,c,m;if(m=e.getAttribute(o)){for(;b.parentNode&&(b=b.parentNode).nodeType===1&&!(f=b.getAttribute(o)););if(f!==m){b=b.parentNode?b.nodeType===11?0:b.getAttribute(o)||0:0;if(!(c=n[m]))c=y[m],c=s(c,n[b]||y[b]),c.key=++w,
n[w]=c;t&&i(m)}e.removeAttribute(o)}else if(t&&(c=a.data(e,"tmplItem")))i(c.key),n[c.key]=c,b=(b=a.data(e.parentNode,"tmplItem"))?b.key:0;if(c){for(f=c;f&&f.key!=b;)f.nodes.push(e),f=f.parent;delete c._ctnt;delete c._wrap;a.data(e,"tmplItem",c)}}var d="_"+t,f,b,g={},c,m,k;c=0;for(m=e.length;c<m;c++)if((f=e[c]).nodeType===1){b=f.getElementsByTagName("*");for(k=b.length-1;k>=0;k--)i(b[k]);i(f)}}function c(a,i,d,f){if(!a)return z.pop();z.push({_:a,tmpl:i,item:this,data:d,options:f})}function b(e,i,d){return a.tmpl(a.template(e),
i,d,this)}function k(e,d){var b=e.options||{};b.wrapped=d;return a.tmpl(a.template(e.tmpl),e.data,b,e.item)}function l(e,d){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(""):b).filter(e||"*"),function(a){if(d)a=a.innerText||a.textContent;else{var e;if(!(e=a.outerHTML))e=document.createElement("div"),e.appendChild(a.cloneNode(!0)),e=e.innerHTML;a=e}return a})}function j(){var e=this.nodes;a.tmpl(null,null,null,this).insertBefore(e[0]);a(e).remove()}var r=a.fn.domManip,o="_tmplitem",q=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
n={},y={},m,d={key:0,data:{}},w=0,t=0,z=[];a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,d){a.fn[e]=function(b){var f=[],b=a(b),c,g,k;c=this.length===1&&this[0].parentNode;m=n||{};if(c&&c.nodeType===11&&c.childNodes.length===1&&b.length===1)b[d](this[0]),f=this;else{g=0;for(k=b.length;g<k;g++)t=g,c=(g>0?this.clone(!0):this).get(),a(b[g])[d](c),f=f.concat(c);t=0;f=this.pushStack(f,e,b.selector)}b=m;m=null;a.tmpl.complete(b);
return f}});a.fn.extend({tmpl:function(e,b,d){return a.tmpl(this[0],e,b,d)},tmplItem:function(){return a.tmplItem(this[0])},template:function(e){return a.template(e,this[0])},domManip:function(e,b,d,c){if(e[0]&&a.isArray(e[0])){for(var g=a.makeArray(arguments),k=e[0],w=k.length,h=0,o;h<w&&!(o=a.data(k[h++],"tmplItem")););o&&t&&(g[2]=function(e){a.tmpl.afterManip(this,e,d)});r.apply(this,g)}else r.apply(this,arguments);t=0;m||a.tmpl.complete(n);return this}});a.extend({tmpl:function(e,b,c,f){var g=
!f;if(g)f=d,e=a.template[e]||a.template(null,e),y={};else if(!e)return e=f.tmpl,n[f.key]=f,f.nodes=[],f.wrapped&&h(f,f.wrapped),a(u(f,null,f.tmpl(a,f)));if(!e)return[];typeof b==="function"&&(b=b.call(f||{}));c&&c.wrapped&&h(c,c.wrapped);b=a.isArray(b)?a.map(b,function(a){return a?s(c,f,e,a):null}):[s(c,f,e,b)];return g?a(u(f,null,b)):b},tmplItem:function(e){var b;for(e instanceof a&&(e=e[0]);e&&e.nodeType===1&&!(b=a.data(e,"tmplItem"))&&(e=e.parentNode););return b||d},template:function(b,d){return d?
(typeof d==="string"?d=p(d):d instanceof a&&(d=d[0]||{}),d.nodeType&&(d=a.data(d,"tmpl")||a.data(d,"tmpl",p(d.innerHTML))),typeof b==="string"?a.template[b]=d:d):b?typeof b!=="string"?a.template(null,b):a.template[b]||a.template(null,q.test(b)?b:a(b)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},
open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){n={}},afterManip:function(b,
d,c){var f=d.nodeType===11?a.makeArray(d.childNodes):d.nodeType===1?[d]:[];c.call(b,d);g(f);t++}})})(jQuery);
(function(){var a,s,u,x,p,h,v=function(a,c){return function(){return a.apply(c,arguments)}};h=this;a=h.jQuery;h.pte=p=p||{};(function(a){return a.fixThickbox=function(a){var b,g,l,j;b=a.jQuery;if(!(b===null||a.frames.length<1))if(log("Fixing thickbox"),j=h.options.pte_tb_width+30,l=h.options.pte_tb_height+38,g=b("#TB_window"),!(g.width()>=j&&g.height()>=l))return log("THICKBOX: "+g.width()+" x "+g.height()),g.css({"margin-left":0-j/2,width:j,height:l}).children("iframe").css({width:j}),a.setTimeout(function(){if(!(b("iframe",
g).height()>l))return b("iframe",g).css({height:l}),log("THICKBOX: "+g.width()+" x "+g.height()),!0},1E3)}})(p);h.log=function(a){if(!h.options.pte_debug)return!0;try{console.log(a)}catch(c){alert(a)}return!0};(function(g){return g.admin=function(){var c,b,g,l,j,r;r="&TB_iframe=true&height="+h.options.pte_tb_height+"&width="+h.options.pte_tb_width;g=null;j=function(b){b=b||g||a("#attachment-id").val();return""+ajaxurl+"?action=pte_ajax&pte-action=launch&id="+b+r};c=function(b){return a('<a class="thickbox" href="'+
j(b)+'">'+objectL10n.PTE+"</a>")};b=function(a){log("Start PTE...");if(h.parent.frames.length>0)return log("Modifying thickbox..."),v(function(){h.parent.tb_click();return!0},this)(),a.stopPropagation()};l=function(){var j;j=a("#imgedit-save-target-"+g);return(j!=null?j.size():void 0)<1?(h.log("Edit Thumbnail Menu not visible, waiting for 300ms"),h.setTimeout(l,300),!1):j.append(c().click(b))};return function(){a(".media-item").each(function(g,h){var j;j=h.id.replace("media-item-","");return c(j).css({"font-size":".8em",
"margin-left":"5px"}).click(b).appendTo(a("tr.image-size th.label",h))});if(imageEdit.open!=null)imageEdit.oldopen=imageEdit.open,imageEdit.open=function(a,b){g=a;imageEdit.oldopen(a,b);return l()};return!0}()}})(p);s=function(){function a(c,b){this.fn=c;this.timeout=b;this.doFunc=v(this.doFunc,this);this.timer=null}a.prototype.doFunc=function(){h.clearTimeout(this.timer);this.timer=h.setTimeout(this.fn,this.timeout);return!0};return a}();h.randomness=function(){return Math.floor(Math.random()*1000001).toString(16)};
h.debugTmpl=function(a){log(a);return!0};h.goBack=function(g){g!=null&&g.preventDefault();return a("#stage2").animate({left:1200},500,"swing",function(){a(this).hide();return a("#stage1").show(0,function(){return a(this).animate({left:0},500,"swing",function(){var c;log("okay cleanup");c={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"delete-images","pte-nonce":a("#pte-delete-nonce").val()};return a.ajax({url:ajaxurl,data:c,global:!1,dataType:"json",success:function(a){return a.error!=
null?log(a.error):log("Deleted tmp files")}})})})})};x=function(a,c){if(a===0)return c;for(;c>0;)a>c?a-=c:c-=a;return a<0||c<0?null:a};u=function(a,c){var b,k,l,j,r;k=thumbnail_info[c];b=k.crop;j=k.width;l=k.height;b=+b;j=+j;l=+l;k=x(j,l);if(b!=null&&b>0){b=(r=h.options.pte_ar[c])!=null?r:null;b==null&&(j!=null)>0&&(l!=null)>0&&(b=k!=null?""+j/k+":"+l/k:""+j+":"+l);log("AR: "+b);if(a!=null&&b!=null&&b!==a)throw"Too many Aspect Ratios. Disabling";return b}};(function(g){var c,b,k,l,j,r,o,q,n,p;g.editor=
function(){var g,d;p();k();n();b();l();j();c();g=a("#pte-loading");d=function(){log("Closing load screen");g.hide();return!0};a("#pte-preview").load(d);g.ajaxStart(function(){return a(this).fadeIn(200)}).ajaxStop(function(){return a(this).fadeOut(200)});h.setTimeout(d,2E3);return!0};p=function(){var b;b=new s(function(){var b;log("reflow called...");g.fixThickbox(h.parent);b=a("#pte-sizes").offset();b=a(h).height()-b.top-2;return a("#pte-sizes").height(b)},100);a(h).resize(b.doFunc).load(b.doFunc);
return!0};k=function(){var b;b=function(b){b.delegate("tr","click",function(b){b.target.type!=="checkbox"&&a("input:checkbox",this).click();return!0});return b.delegate("input:checkbox","click",function(){this.checked||a(this).is("input:checked")?a(this).parents("tr").first().removeClass("selected"):a(this).parents("tr").first().addClass("selected");return!0})};b(a("#stage2"));return b(a("#stage1"))};q=null;o={keys:!0,minWidth:3,minHeight:3,handles:!0,zIndex:1200,instance:!0,onSelectEnd:function(b,
d){return d.width&&d.width>0&&d.height&&d.height>0&&a(".pte-size").filter(":checked").size()>0?(log("Enabling button"),a("#pte-submit").removeAttr("disabled")):(log("Disabling button"),a("#pte-submit").attr("disabled",!0))}};n=function(){return q=a("#pte-image img").imgAreaSelect(o)};r=function(a){log("setting aspectRatio: "+a);q.setOptions({aspectRatio:a});return q.update()};b=function(){var b;b=new s(function(){var b;b=null;a("input.pte-size").filter(":checked").each(function(c,g){try{b=u(b,a(g).val())}catch(h){return b=
null,b!==q.getOptions().aspectRatio&&alert(h),!1}return!0});r(b);o.onSelectEnd(null,q.getSelection());return!0},50);return a("input.pte-size").click(b.doFunc)};l=function(){var b;a("#pte-submit").click(function(){var d,c;log("Clicked Submit...");c=q.getSelection();d=a("#pte-sizer").val();d={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"resize-images","pte-sizes[]":a(".pte-size").filter(":checked").map(function(){return a(this).val()}).get(),x:Math.floor(c.x1/d),y:Math.floor(c.y1/d),w:Math.floor(c.width/
d),h:Math.floor(c.height/d)};log(d);q.setOptions({hide:!0,x1:0,y1:0,x2:0,y2:0});a("#pte-submit").attr("disabled",!0);a.getJSON(ajaxurl,d,b);return!0});return b=function(b){log(b);if(b.error!=null&&b.thumbnails==null)alert(b.error);else return a("#stage1").animate({left:-a(h).width()},500,"swing",function(){a(this).hide();a("#stage2").html(a("#stage2template").tmpl(b)).show(0,function(){a(this).animate({left:0},500);return!0});return!0}),!1}};j=function(){var b;a("#pte-confirm").live("click",function(){var d,
c;log("Confirming");c={};a("input.pte-confirm").filter(":checked").each(function(b,d){var e;e=a(d).val();return c[e]=a("#pte-"+e+"-file").val()});d={id:a("#pte-post-id").val(),action:"pte_ajax","pte-action":"confirm-images","pte-nonce":a("#pte-nonce").val(),"pte-confirm":c};log(d);return a.getJSON(ajaxurl,d,b)});return b=function(b){log(b);a("#stage2").animate({left:-a(h).width()},500,"swing",function(){a(this).hide();a("#stage3").html(a("#stage3template").tmpl(b)).show(0,function(){a(this).animate({left:0},
500);return!0});return!0});return!1}};return c=function(){var b,c;c=function(b){var e;var c,d;b!=null&&b.preventDefault();e=(c=(d=b.data)!=null?d.selector:void 0)!=null?c:".pte-size",b=e;return a(b).filter(":checked").click()};b=function(b){var e;var c,d;b!=null&&b.preventDefault();e=(c=b!=null?(d=b.data)!=null?d.selector:void 0:void 0)!=null?c:".pte-size",b=e;return a(b).not(":checked").click()};a("#pte-selectors .all").click(b);a("#pte-selectors .none").click(c).click();a("#stage2").delegate("#pte-stage2-selectors .all",
"click",{selector:".pte-confirm"},b);a("#stage2").delegate("#pte-stage2-selectors .none","click",{selector:".pte-confirm"},c);return!0}})(p)}).call(this);
